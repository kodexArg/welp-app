{% load core_tags %}

{% comment %}
Ticket Container - Soporta dos modos:
- expandible: Para vista de lista (default)
- expandido: Para vista de detalle (sin interactividad)
{% endcomment %}

{% if expandido %}
    <!-- Modo expandido para vista de detalle -->
    <article class="ticket-container-detail">
        <div class="ticket-summary-detail">
            <div class="ticket-title-detail">
                {{ ticket.title }}
            </div>
            <div class="ticket-info">
                <span class="tags-ticket-udn">{{ ticket.udn.name }}</span>
                <span class="tags-ticket-sector">{{ ticket.sector.name }}</span>
                <span class="tags-ticket-category">{{ ticket.accounting_category.name }}</span>
                {% with action_info=ticket|get_ticket_action_info %}
                <span class="status status-{{ action_info.status }} tag" style="color: {{ action_info.color }};">
                    <span class="mr-1">{{ action_info.icon }}</span>
                    {{ action_info.current_action }}
                    <div id="ticket-feedback-count-{{ ticket.id }}" class="inline align-middle text-xs" 
                        hx-get="{% url 'welp_payflow:htmx-ticket-feedback-count' ticket.id %}"
                        hx-trigger="load"
                        hx-swap="outerHTML">
                    </div>
                </span>
                {% endwith %}
            </div>
        </div>
        
        <div class="ticket-details-detail">
            <div class="ticket-details-content">
                {% for message in ticket.messages.all %}
                    {% ticket_message message %}
                {% empty %}
                    <div class="ticket-no-messages">
                        ⚠️ Este ticket no tiene mensajes
                    </div>
                {% endfor %}
                
                {% if not hide_buttons %}
                    {% ticket_actions ticket %}
                {% endif %}
            </div>
        </div>
    </article>
{% else %}
    <!-- Modo expandible para vista de lista -->
<article class="ticket-container">
    <details>
        <summary class="ticket-summary">
            <div class="ticket-title">
                <i class="ticket-caret"></i>
                {{ ticket.title }}
            </div>
            <div class="ticket-info">
                <span class="tags-ticket-udn">{{ ticket.udn.name }}</span>
                <span class="tags-ticket-sector">{{ ticket.sector.name }}</span>
                <span class="tags-ticket-category">{{ ticket.accounting_category.name }}</span>
                {% with action_info=ticket|get_ticket_action_info %}
                <span class="status status-{{ action_info.status }} tag" style="color: {{ action_info.color }};">
                    <span class="mr-1">{{ action_info.icon }}</span>
                    {{ action_info.current_action }}
                    <div id="ticket-feedback-count-{{ ticket.id }}" class="inline align-middle text-xs" 
                        hx-get="{% url 'welp_payflow:htmx-ticket-feedback-count' ticket.id %}"
                        hx-trigger="load"
                        hx-swap="outerHTML">
                    </div>
                </span>
                {% endwith %}
            </div>
        </summary>
        
        <div class="ticket-details">
            <div class="ticket-details-content">
                {% for message in ticket.messages.all %}
                    {% ticket_message message %}
                {% empty %}
                    <div class="ticket-no-messages">
                        ⚠️ Este ticket no tiene mensajes
                    </div>
                {% endfor %}
                {% if not hide_buttons %}
                    {% ticket_actions ticket %}
                {% endif %}
            </div>
        </div>
    </details>
</article>
{% endif %}