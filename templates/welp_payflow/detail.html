{% extends "core/base.html" %}
{% load core_tags %}
{% load django_vite %}

{% block title %}{{ ticket.title }} - Welp Payflow{% endblock %}

{% block content %}
<section>
    <div class="ticket-detail-header">
        <div class="ticket-detail-breadcrumb">
            <a href="{% url 'welp_payflow:list' %}" class="ticket-detail-back">
                ← Volver a Solicitudes
            </a>
        </div>
        
        <h1>{{ ticket.title }}</h1>
        
        <div class="ticket-detail-meta">
            <span class="ticket-detail-id">Solicitud #{{ ticket.id }}</span>
            <span class="ticket-detail-created">Creada {{ ticket.created_on|date:"d \\d\\e F \\d\\e Y" }}</span>
        </div>
    </div>

    <div class="ticket-detail-container">
        {% ticket_container ticket expandido=True %}
    </div>
    
    <div class="ticket-detail-response-section">
        <h3>Responder a esta solicitud</h3>
        <div class="ticket-response-form">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group">
                    <label for="response_body">Mensaje de respuesta</label>
                    <textarea 
                        id="response_body" 
                        name="response_body" 
                        class="form-input"
                        rows="4"
                        placeholder="Escriba su respuesta o comentario aquí..."
                        required
                    ></textarea>
                </div>
                
                <div class="form-group">
                    <label for="status">Cambiar estado (opcional)</label>
                    <select id="status" name="status" class="form-select">
                        <option value="">Mantener estado actual</option>
                        <option value="feedback">Comentar</option>
                        <option value="solved">Marcar como resuelto</option>
                        <option value="authorized">Autorizar</option>
                        <option value="closed">Cerrar ticket</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="attachments">Archivos adjuntos (opcional)</label>
                    <input 
                        type="file" 
                        id="attachments" 
                        name="attachments" 
                        class="form-input"
                        multiple
                        accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.gif"
                    >
                    <p class="form-help">Máximo 50MB por archivo. Formatos: PDF, DOC, XLS, imágenes</p>
                </div>
                
                <div class="ticket-response-actions">
                    <button type="submit" class="button-primary">
                        Enviar Respuesta
                    </button>
                    <a href="{% url 'welp_payflow:list' %}" class="button-secondary">
                        Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
    {% comment %}
    No incluir ticket_interactivity.js en vista de detalle
    porque el ticket siempre está expandido
    {% endcomment %}
{% endblock %} 